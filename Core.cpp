//
// Created by yvonm on 16/03/2024.
//

#include "Core.h"
#include <fstream>
#include <iostream>
#include <random>

void Core::initialize() {
    drawFlag = false;

    opcode = 0;

    for (unsigned char &i: memory)
        i = 0;

    for (unsigned char &i: V)
        i = 0;

    I = 0;
    pc = 0x200;

    for (unsigned char &i: gfx)
        i = false;

    delay_timer = 0;
    sound_timer = 0;

    for (unsigned short &i: stack)
        i = 0;

    sp = 0;

    for (unsigned char &i: key)
        i = false;

    loadFontSet();
}

void Core::loadFontSet() {
    unsigned char fontSet[80] = {
            0xF0, 0x90, 0x90, 0x90, 0xF0,// 0
            0x20, 0x60, 0x20, 0x20, 0x70,// 1
            0xF0, 0x10, 0xF0, 0x80, 0xF0,// 2
            0xF0, 0x10, 0xF0, 0x10, 0xF0,// 3
            0x90, 0x90, 0xF0, 0x10, 0x10,// 4
            0xF0, 0x80, 0xF0, 0x10, 0xF0,// 5
            0xF0, 0x80, 0xF0, 0x90, 0xF0,// 6
            0xF0, 0x10, 0x20, 0x40, 0x40,// 7
            0xF0, 0x90, 0xF0, 0x90, 0xF0,// 8
            0xF0, 0x90, 0xF0, 0x10, 0xF0,// 9
            0xF0, 0x90, 0xF0, 0x90, 0x90,// A
            0xE0, 0x90, 0xE0, 0x90, 0xE0,// B
            0xF0, 0x80, 0x80, 0x80, 0xF0,// C
            0xE0, 0x90, 0x90, 0x90, 0xE0,// D
            0xF0, 0x80, 0xF0, 0x80, 0xF0,// E
            0xF0, 0x80, 0xF0, 0x80, 0x80 // F
    };

    for (int i = 0; i < 80; i++)
        memory[i] = fontSet[i];
}
